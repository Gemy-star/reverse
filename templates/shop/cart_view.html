{% extends "base.html" %}
{% load static i18n %}

{% block title %}{% trans "Shopping Cart" %}{% endblock %}

{% block content %}
<section class="section pt-2">
<div class="container my-5 pt-4">

    <div class="section-header">
        <h2>{% trans "Shopping Cart" %}</h2>
    </div>

    <div class="row">
        {% for item in cart.items.all %}
        <div class="col-md-3 mb-4">
            <div class="product-card text-center">
                {% with main_image=item.product_variant.product.get_main_image %}
                <div class="position-relative">
                    <a href="{{ item.product_variant.product.get_absolute_url }}">
                        {% if main_image and main_image.image %}
                        <img src="{{ main_image.image.url }}" alt="{{ item.product_variant.product.name }}">
                        {% else %}
                        <img src="https://placehold.co/400x250/e0e0e0/555555?text=No+Image" alt="{% trans 'No Image' %}">
                        {% endif %}
                    </a>
                    <div class="product-icons">
                        <a href="#" class="remove-from-cart" data-id="{{ item.id }}" title="{% trans 'Remove from Cart' %}">
                            <i class="fas fa-times"></i>
                        </a>
                    </div>
                </div>
                {% endwith %}
                <div class="product-name">
                    {{ item.product_variant.product.name }}<br>
                    <small>{% trans "Qty" %}: {{ item.quantity }}</small><br>
                    <small>{% trans "Total" %}: {{ item.total_price }}</small>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="text-muted col-12">{% trans "Your cart is empty." %}</div>
        {% endfor %}
    </div>

    {% if cart.items.exists %}
    <div class="text-end mt-4">
        <a href="{% url 'checkout' %}" class="btn btn-primary">{% trans "Proceed to Checkout" %}</a>
    </div>
    {% endif %}

</div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll('.remove-from-cart').forEach(function (btn) {
        btn.addEventListener('click', function (e) {
            e.preventDefault();
            const itemId = this.dataset.id;
            // TODO: Replace this with AJAX call if needed
            if (confirm("Are you sure you want to remove this item?")) {
                window.location.href = `/cart/remove/${itemId}/`;  // example URL
            }
        });
    });
});
</script>
{% endblock %}
